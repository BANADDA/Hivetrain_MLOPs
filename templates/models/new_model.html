{% extends 'new_project.html' %}
{% load static %}

{% block exp_name %}
{{experiment.name}}
{% endblock %}

{% block exp_block %}
<div class="container">
    <div class="container card bg-white rounded mb-5">
        <div class="row justify-content-between align-content-between card-body">
          <div class="col-md">
            <h2 class="font-weight-bold text-black fs-1">
               {{form_data.model_name}}
            </h2>
            <div class="d-md-flex flex-wrap">
              <p class="text-break mb-md-3 mr-md-3" style="max-width: calc(100% - 150px); color: #4E4D4D; font-weight: 500; font-size: 14px;">
                {{form_data.model_domain}}
                {{form_data.model_details}}
              </p>
            </div>
          </div>
          <div class="col-md-auto d-flex justify-content-end">
            <img src="https://www.kdnuggets.com/wp-content/uploads/wijaya_top_machine_learning_papers_read_2023_1.jpg" alt="Image Description" class="img-fluid d-none d-md-inline-block" style="max-width: 150px; max-height: 150px;">
          </div>
        </div>
      </div>
    </div>
    <div class="center-container container-fluid block">
<!-- Submit button -->
<div class="mb-3 text-end">
    <button type="submit" class="btn btn-lg article">Submit <i class=" pl-2 fa fa-arrow-right"></i></button>
</div>
<style>
    .title-container {
        text-align: center; /* Center the title */
        margin-bottom: 20px; /* Add some space below the title */
        background-color: #02310D; /* Green background color */
        padding:10px;
    }
    .modal-title {
        color: white; /* Title color */
        margin: 0; /* Remove default margin */
    }
    /* Style Cancel button */
    .cancel-btn {
        margin-right: 5px; /* Add margin between buttons */
    }
    
    /* Ensure close button is aligned properly */
    .close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        color: #aaa;
    }
        /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }
      
      /* Modal Content/Box */
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        padding-bottom: 0px;
        border: 1px solid #888;
        width: 50%; /* Could be more or less, depending on screen size */
      }
      
      /* Close Button */
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      
      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
      
        .modal-backdrop {
            filter: blur(2px);
        }
    button.article{
      background: #025A42 !important;
      color: #fff !important;
    }
    .form-label {
        font-size: 16px;
        font-weight: bold;
    }
    .card-model {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add shadow */
        border: 2px solid transparent; /* Default border size and color */
    }
    .card-title {
        font-size: 20px;
        font-weight: bold;
    }
    .card-model p {
        font-size: 14px;
        font-weight: 600;
        color: #4E4D4D;
    }
    .card-model:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2); /* Increase shadow on hover */
    }
   
    .card-selected {
        background-color: #f0f0f0; /* Greyish background color for selected card */
        border: 3px solid black; /* Increase border size and change color to black when selected */
    }
    /* Style for selected radio button */
    .card-radio-input:checked + .card-img-top {
        filter: invert(100%);
    }
    /* Directly set color of selected radio button */
    .card-radio-input:checked {
        color: black;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to close the dataset modal
        function closeModal() {
            document.getElementById('datasetModal').style.display = 'none';
        }
    
        // Add event listener to show dataset modal
        var modalTriggerBtn = document.getElementById('datasetModalTrigger');
        modalTriggerBtn.addEventListener('click', function () {
            document.getElementById('datasetModal').style.display = 'block';
        });
    
        // Add event listener to handle form submission
        var datasetForm = document.getElementById('datasetForm');
        var submitButton = document.getElementById('submitDatasetBtn');
        submitButton.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default form submission
    
            // Get the selected dataset directly from the form
            var selectedDatasetInput = document.querySelector('input[name="selectedDataset"]:checked');
    
            if (selectedDatasetInput) {
                var selectedDataset = selectedDatasetInput.value;
    
                // Update the DOM to display the selected dataset
                document.getElementById('selectedDataset').textContent = selectedDataset;
                document.getElementById('selectedDatasetContainer').style.display = 'block';
    
                // Determine the dataset type
                var datasetType = determineDatasetType(selectedDataset);

                // Determine the dataset size
                var datasetSize = determineDatasetSize(selectedDataset, datasetType);

                // Display options based on dataset type and size
                displayOptions(datasetType, datasetSize);

                // Close the modal after submission
                closeModal();
            } else {
                // If no dataset is selected, display an error message or handle it accordingly
                console.log('Please select a dataset.');
            }
        });
    
        // Add event listener to close dataset modal (using the modal close button)
        var modalCloseBtn = document.getElementById('modalCloseBtn');
        modalCloseBtn.addEventListener('click', function () {
            closeModal();
        });
    
        // Add event listener to close dataset modal (using the modal background)
        var modalBackground = document.getElementById('datasetModal');
        modalBackground.addEventListener('click', function (event) {
            if (event.target === modalBackground) {
                closeModal();
            }
        });

        // Add event listener to remove the selected dataset
        var removeDatasetBtn = document.getElementById('removeDatasetBtn');
        removeDatasetBtn.addEventListener('click', function () {
            document.getElementById('selectedDatasetContainer').style.display = 'none';
            document.getElementById('selectedDataset').textContent = '';
        });
    });        

    function determineDatasetType(datasetContent) {
        // Split the dataset content by line breaks to analyze each line
        var lines = datasetContent.split('\n');

        // Check if the dataset content includes image data
        var imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp'];
        var containsImage = lines.some(function(line) {
            return imageExtensions.some(function(extension) {
                return line.trim().toLowerCase().endsWith(extension);
            });
        });

        if (containsImage) {
            return 'image';
        }

        // Check if the dataset content includes CSV data
        var containsCSVHeader = lines[0].split(',').length > 1;
        if (containsCSVHeader) {
            return 'csv';
        }

        // If no specific type is detected, return 'unknown'
        return 'unknown';
    }

    function determineDatasetSize(datasetContent, datasetType) {
        if (datasetType === 'image') {
            // Count the number of image files
            var lines = datasetContent.split('\n');
            var imageCount = lines.filter(function(line) {
                return line.trim() !== ''; // Exclude empty lines
            }).length;

            return imageCount;
        } else if (datasetType === 'csv') {
            // Count the number of rows in CSV data
            var rows = datasetContent.split('\n');
            // Exclude the header row if present
            var rowCount = rows.length - 1; // Subtract 1 for the header row
            return rowCount;
        }

        // For other types or unknown type, return 0
        return 0;
    }

    function displayOptions(datasetType, datasetSize) {
        // Display options for selecting the percentage of data
        // to be used for training, validation, and testing based on dataset type and size
        if (datasetType === 'image') {
            console.log('Image dataset detected with ' + datasetSize + ' images.');
            // Display options for image dataset
        } else if (datasetType === 'csv') {
            console.log('CSV dataset detected with ' + datasetSize + ' rows.');
            // Display options for CSV dataset
        } else {
            console.log('Unknown dataset type.');
            // Display options for unknown dataset type
        }
    }

    // Get all radio buttons
    var radioButtons = document.querySelectorAll('.card-radio-input');

    // Add event listener to each radio button
    radioButtons.forEach(function(radioButton) {
        radioButton.addEventListener('change', function() {
            // Remove the 'card-selected' class from all cards
            document.querySelectorAll('.card').forEach(function(card) {
                card.classList.remove('card-selected');
            });

            // Add the 'card-selected' class to the parent card of the selected radio button
            this.closest('.card').classList.add('card-selected');

            // Check which card is selected
            var selectedCardId = this.id;
            if (selectedCardId === 'model1') {
                // Show the form and center it
                document.querySelector('.center-container').style.display = 'flex';
                document.querySelector('.center-container').style.justifyContent = 'center';
                document.querySelector('.center-container').style.alignItems = 'center';
                // Hide the select model button
                document.querySelector('#select-model-btn').style.display = 'none';
            } else if (selectedCardId === 'model2') {
                // Hide the form
                document.querySelector('.center-container').style.display = 'none';
                // Show the select model button
                document.querySelector('#select-model-btn').style.display = 'block';
            }
        });
    });
</script>
{% endblock %}
