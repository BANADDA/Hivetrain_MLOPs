{% extends 'new_project.html' %}
{% load static %}

{% block exp_name %}
{{experiment.name}}
{% endblock %}

{% block exp_block %}
<div class="container">
    <div id="validationAlerts"></div>
    {% comment %} Conditionally render  model form {% endcomment %}
    
    <div id="validationAlerts"></div>
    {% if latest_model %}
    <script type="text/javascript">
        {% with latest_model.training_jobs.first.id as trainingJobId %}
            // Only attempt to redirect if a training job ID is available
            {% if trainingJobId %}
                var trainingJobId = "{{ trainingJobId }}";
                window.location.href = "{% url 'monitor_training' trainingJobId %}";
            {% else %}
                console.log("No training jobs found for the latest model.");
            {% endif %}
        {% endwith %}
    </script>
{% else %}
    <div class="container card bg-white rounded mb-5">
        <div class="row justify-content-between align-content-between card-body custom-card-body">
          <div class="col-md">
            <h2 class="font-weight-bold text-black fs-1">
                {{experiment.name}}
            </h2>
            <div class="d-md-flex flex-wrap">
              <p class="text-break mb-md-3 mr-md-3" style="max-width: calc(100% - 150px); color: #4E4D4D; font-weight: 500; font-size: 14px;">
                Select <span style="font-weight: 700;">New Model</span> to create a machine learning model from scratch, or choose <span style="font-weight: 700;">FineTune</span> to fine-tune existing models from our repositories.
              </p>
            </div>
          </div>
          <div class="col-md-auto d-flex justify-content-end">
            <img src="https://www.kdnuggets.com/wp-content/uploads/wijaya_top_machine_learning_papers_read_2023_1.jpg" alt="Image Description" class="img-fluid d-none d-md-inline-block" style="max-width: 150px; max-height: 150px;">
          </div>
        </div>
      </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-auto col-sm-6 mb-3 mr-3">
            <label class="card card-model position-relative">
                <input type="radio" id="model1" name="model" class="card-radio-input visually-hidden position-absolute" style="top: 5px; left: 5px;">
                <img class="card-img-top p-2" src="https://www.kaggle.com/static/images/models/new_model.svg" alt="Card image cap" style="width: 25%; margin: auto; display: block;">
                <div class="card-body text-center">
                    <h5 class="card-title" style="font-weight: bold;">New Model</h5>
                    <p class="card-text">Create new machine learning model from scratch</p>
                </div>
            </label>
        </div>
        <div class="col-md-auto col-sm-6 mb-3 ml-3">
            <label class="card card-model position-relative">
                <input type="radio" id="model2" name="model" class="card-radio-input visually-hidden position-absolute" style="top: 5px; left: 5px;">
                <img class="card-img-top p-2" src="https://www.kaggle.com/static/images/models/new_model_instance_light.svg" alt="Card image cap" style="width: 25%; margin: auto; display: block;">
                <div class="card-body text-center">
                    <h5 class="card-title" style="font-weight: bold;">FineTune</h5>
                    <p class="card-text">Fine Tune existing models from our repositories</p>
                </div>
            </label>
        </div>
    </div>
    <div class="center-container container bg-transparent rounded">
        {% comment %} <div class="card-body"> {% endcomment %}
        {% comment %} <form id="experiment-form">
            {% csrf_token %} {% endcomment %}
            <!-- Section 1: Add Model Details -->
            <div class="mb-3">
                <label for="model-name" class="form-label">1. Add Model Details</label>
                <input type="text" class="form-control" id="model-name" placeholder="Enter Model Name">
                <!-- Add the id="model-name" attribute here -->
                {% comment %} <textarea class="form-control mt-2" id="model-description" rows="3" placeholder="Enter Model Description" required></textarea> {% endcomment %}
            </div>            
            <div class="row">
                <!-- Section 2: Model Domain -->
                <div class="col-md-12">
                    <div class="mb-3">
                        <label for="model-domain" class="form-label">2. Model Domain</label>
                        <div class="card">
                            <div class="card-header" style="background-color: #02310D; color: white;">
                                Select your model domain
                            </div>
                            <div class="card-body">
                                <div id="button-container">
                                    <button class="selectable-button" id="cv-button">Computer Vision</button>
                                    <button class="selectable-button" id="nlp-button">NLP</button>
                                    {% comment %} <button class="selectable-button" id="time-series-button">Time Series</button> {% endcomment %}
                                </div>
                                <div class="container pt-3">
                                <!-- NLP task buttons-->
                                <div id="nlp-tasks" style="display: none;">
                                    <hr class="solid">
                                    <div class="card border-success mb-3">
                                        <div class="card-header bg-transparent border-success">
                                            <div class="row justify-content-center">
                                                <div class="col text-center">
                                                    <a class="nlp-task-button btn article" data-section-id="machine-translation-section">Machine Translation</a>
                                                </div>
                                                <div class="col-auto">
                                                    <div class="divider-vertical"></div>
                                                </div>
                                                <div class="col text-center">
                                                    <a class="nlp-task-button btn article" data-section-id="speech-recognition-section">Speech Recognition</a>
                                                </div>
                                                <div class="col-auto">
                                                    <div class="divider-vertical"></div>
                                                </div>
                                                <div class="col text-center">
                                                    <a class="nlp-task-button btn article" data-section-id="named-entity-recognition-section">Named Entity Recognition</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <!-- Form for Machine Translation task -->
                                            <div id="machine-translation-section" class="nlp-task-section" style="display: none;">
                                                <h5 class="card-title">Machine Translation</h5>
                                                <div class="form-group">
                                                    <label for="source_language">Source Language:</label>
                                                    <select class="form-control" id="source_language">
                                                        <option value="english">English</option>
                                                        <option value="spanish">Spanish</option>
                                                        <option value="french">French</option>
                                                        <!-- Add more language options as needed -->
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="target_language">Target Language:</label>
                                                    <select class="form-control" id="target_language">
                                                        <option value="english">English</option>
                                                        <option value="spanish">Spanish</option>
                                                        <option value="french">French</option>
                                                        <!-- Add more language options as needed -->
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="model_architecture">Model Architecture:</label>
                                                    <select class="form-control" id="model_architecture">
                                                        <option value="transformer">Transformer</option>
                                                        <option value="seq2seq">Seq2Seq</option>
                                                        <option value="bert">BERT</option>
                                                        <!-- Add more model architectures as needed -->
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="evaluation_metrics">Evaluation Metrics:</label><br>
                                                    <input type="checkbox" id="bleu_score" name="bleu_score">
                                                    <label for="bleu_score">BLEU Score</label><br>
                                                    <input type="checkbox" id="meteor_score" name="meteor_score">
                                                    <label for="meteor_score">METEOR Score</label><br>
                                                    <input type="checkbox" id="rouge_score" name="rouge_score">
                                                    <label for="rouge_score">ROUGE Score</label><br>
                                                    <!-- Add more evaluation metrics as needed -->
                                                </div>
                                            </div>
                                
                                            <!-- Form for Speech Recognition task -->
                                            <div id="speech-recognition-section" class="nlp-task-section" style="display: none;">
                                                <h5 class="card-title">Speech Recognition</h5>
                                                <div class="form-group">
                                                    <label for="audio_input_format">Audio Input Format:</label>
                                                    <select class="form-control" id="audio_input_format">
                                                        <option value="wav">WAV</option>
                                                        <option value="mp3">MP3</option>
                                                        <option value="ogg">OGG</option>
                                                        <!-- Add more audio format options as needed -->
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="model_architecture">Model Architecture:</label>
                                                    <input type="text" class="form-control" id="model_architecture" placeholder="Enter model architecture">
                                                </div>
                                                <div class="form-group">
                                                    <label for="language_model">Language Model:</label>
                                                    <input type="text" class="form-control" id="language_model" placeholder="Enter language model">
                                                </div>
                                                <div class="form-group">
                                                    <label for="evaluation_metrics">Evaluation Metrics:</label><br>
                                                    <input type="checkbox" id="wer" name="wer">
                                                    <label for="wer">Word Error Rate (WER)</label><br>
                                                    <input type="checkbox" id="cer" name="cer">
                                                    <label for="cer">Character Error Rate (CER)</label><br>
                                                    <input type="checkbox" id="accuracy" name="accuracy">
                                                    <label for="accuracy">Accuracy</label><br>
                                                    <!-- Add more evaluation metrics as needed -->
                                                </div>
                                            </div>
                                
                                            <!-- Form for Named Entity Recognition task -->
                                            <div id="named-entity-recognition-section" class="nlp-task-section" style="display: none;">
                                                <h5 class="card-title">Named Entity Recognition</h5>
                                                <div class="form-group">
                                                    <label for="input_text_format">Input Text Format:</label>
                                                    <select class="form-control" id="input_text_format">
                                                        <option value="plain_text">Plain Text</option>
                                                        <option value="pdf">PDF</option>
                                                        <option value="docx">DOCX</option>
                                                        <!-- Add more text format options as needed -->
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="model_architecture">Model Architecture:</label>
                                                    <input type="text" class="form-control" id="model_architecture" placeholder="Enter model architecture">
                                                </div>
                                                <div class="form-group">
                                                    <label for="entity_types">Entity Types:</label>
                                                    <input type="text" class="form-control" id="entity_types" placeholder="Enter entity types">
                                                </div>
                                                <div class="form-group">
                                                    <label for="evaluation_metrics">Evaluation Metrics:</label><br>
                                                    <input type="checkbox" id="precision" name="precision">
                                                    <label for="precision">Precision</label><br>
                                                    <input type="checkbox" id="recall" name="recall">
                                                    <label for="recall">Recall</label><br>
                                                    <input type="checkbox" id="f1_score" name="f1_score">
                                                    <label for="f1_score">F1-score</label><br>
                                                    <!-- Add more evaluation metrics as needed -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- CV task buttons -->
                                <div id="cv-tasks" style="display: none;">
                                    <hr class="solid">
                                    <div class="card border-success mb-3">
                                        <div class="card-header bg-transparent border-success">
                                            <div class="row justify-content-center">
                                                <div class="col text-center">
                                                    <a class="cv-task-button btn article" data-section-id="object-detection-section">Object Detection</a>
                                                </div>
                                                <div class="col-auto">
                                                    <div class="divider-vertical"></div>
                                                </div>
                                                <div class="col text-center">
                                                    <a class="cv-task-button btn article" data-section-id="image-classification-section">Image Classification</a>
                                                </div>
                                                <div class="col-auto">
                                                    <div class="divider-vertical"></div>
                                                </div>
                                                {% comment %} <div class="col text-center">
                                                    <a class="cv-task-button btn article" data-section-id="segmentation-section">Segmentation</a>
                                                </div> {% endcomment %}
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="object-detection-section" class="cv-task-section" style="display: none;">
                                                <h5 class="card-title">Object Detection</h5>
                                                
                                                <div class="form-group">
                                                    <label for="input_image_size">Input Image Size/Resolution:</label>
                                                    <input type="text" class="form-control" id="input_image_size" placeholder="Enter input image size/resolution">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="model_architecture">Model Architecture:</label>
                                                    <select class="form-control" id="model_architecture">
                                                        <option value="Faster R-CNN">Faster R-CNN</option>
                                                        <option value="YOLO">YOLO (You Only Look Once)</option>
                                                        <option value="SSD">SSD (Single Shot MultiBox Detector)</option>
                                                        <!-- Add more model architectures as needed -->
                                                    </select>
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="anchor_box_sizes">Anchor Box Sizes:</label>
                                                    <input type="text" class="form-control" id="anchor_box_sizes" placeholder="Enter anchor box sizes (e.g., 32, 64, 128)">
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label for="anchor_box_aspect_ratios">Anchor Box Aspect Ratios:</label>
                                                    <input type="text" class="form-control" id="anchor_box_aspect_ratios" placeholder="Enter anchor box aspect ratios (e.g., 0.5, 1, 2)">
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label for="anchor_box_scales">Anchor Box Scales:</label>
                                                    <input type="text" class="form-control" id="anchor_box_scales" placeholder="Enter anchor box scales (e.g., 0.5, 1, 2)">
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label for="anchor_box_placement">Anchor Box Placement:</label>
                                                    <input type="text" class="form-control" id="anchor_box_placement" placeholder="Enter anchor box placement information">
                                                </div>                                                
                                            
                                                <div class="form-group">
                                                    <label for="data_augmentation">Data Augmentation Techniques:</label><br>
                                                    <input type="checkbox" id="rotation" name="rotation">
                                                    <label for="rotation">Rotation</label><br>
                                                    <input type="checkbox" id="translation" name="translation">
                                                    <label for="translation">Translation</label><br>
                                                    <input type="checkbox" id="scaling" name="scaling">
                                                    <label for="scaling">Scaling</label><br>
                                                    <input type="checkbox" id="flipping" name="flipping">
                                                    <label for="flipping">Flipping</label><br>
                                                    <!-- Add more data augmentation techniques as needed -->
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="learning_rate">Learning Rate:</label>
                                                    <input type="number" class="form-control" id="learning_rate" step="0.001" placeholder="Enter learning rate">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="batch_size">Batch Size:</label>
                                                    <input type="number" class="form-control" id="batch_size" placeholder="Enter batch size">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="optimizer">Optimizer:</label>
                                                    <select class="form-control" id="optimizer">
                                                        <option value="SGD">SGD</option>
                                                        <option value="Adam">Adam</option>
                                                        <option value="RMSprop">RMSprop</option>
                                                        <!-- Add more optimizers as needed -->
                                                    </select>
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="dropout_rate">Dropout Rate:</label>
                                                    <input type="number" class="form-control" id="dropout_rate" step="0.1" placeholder="Enter dropout rate">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="evaluation_metrics">Evaluation Metrics:</label>
                                                    <input type="text" class="form-control" id="evaluation_metrics" placeholder="Enter evaluation metrics">
                                                </div>
                                            </div>
                                            <div id="image-classification-section" class="cv-task-section" style="display: none;">
                                                <!-- Content related to Image Classification -->
                                                <h5 class="card-title">Image Classification</h5>
                                                <div class="form-group">
                                                    <label for="num_layers">Number of Layers:</label>
                                                    <input type="number" class="form-control" id="num_layers" placeholder="Enter number of layers">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="conv_kernel_size">Convolutional Kernel Size:</label>
                                                    <input type="text" class="form-control" id="conv_kernel_size" placeholder="Enter convolutional kernel size">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="num_filters">Number of Filters:</label>
                                                    <input type="number" class="form-control" id="num_filters" placeholder="Enter number of filters">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="learning_rate">Learning Rate:</label>
                                                    <input type="number" class="form-control" id="learning_rate" step="0.001" placeholder="Enter learning rate">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="batch_size">Batch Size:</label>
                                                    <input type="number" class="form-control" id="batch_size" placeholder="Enter batch size">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="optimizer">Optimizer:</label>
                                                    <select class="form-control" id="optimizer">
                                                        <option value="SGD">SGD</option>
                                                        <option value="Adam">Adam</option>
                                                        <option value="RMSprop">RMSprop</option>
                                                    </select>
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label for="dropout_rate">Dropout Rate:</label>
                                                    <input type="number" class="form-control" id="dropout_rate" step="0.1" placeholder="Enter dropout rate">
                                                </div>
                                            
                                                <div class="form-group">
                                                    <label>Data Augmentation Techniques:</label><br>
                                                    <input type="checkbox" id="rotation" name="rotation">
                                                    <label for="rotation">Rotation</label><br>
                                                    <input type="checkbox" id="translation" name="translation">
                                                    <label for="translation">Translation</label><br>
                                                    <input type="checkbox" id="scaling" name="scaling">
                                                    <label for="scaling">Scaling</label><br>
                                                    <input type="checkbox" id="flipping" name="flipping">
                                                    <label for="flipping">Flipping</label><br>
                                                </div>
                                                
                                            </div>
                                        {% comment %} <div class="card-footer bg-transparent border-success">Footer</div> {% endcomment %}
                                    </div>                                    
                                </div>                                
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Section 3: Dataset Selection -->
<div class="col-md-12">
    <div class="mb-3">
        <label class="form-label">3. Dataset Selection</label>
        <div class="card" style="width: 1000px;"> <!-- Set the width to 700px -->
            <div class="card-header" style="background-color: #02310D; color: white;">
                Provide link to your dataset
            </div>
            <div class="card-body">
                <!-- Dataset URL Input -->
                <div class="form-group">
                    <label for="dataset_url">Dataset URL:</label>
                    <input type="text" class="form-control" id="dataset_url" placeholder="Enter dataset URL">
                </div>
                
                <!-- Percentage Input for Train, Test, and Validation -->
                <div class="form-group">
                    <label for="train_percentage">Train Percentage:</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="train_percentage" placeholder="Enter train percentage" onchange="updatePercentage()">
                        <div class="input-group-append">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="test_percentage">Test Percentage:</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="test_percentage" placeholder="Enter test percentage" onchange="updatePercentage()">
                        <div class="input-group-append">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="validation_percentage">Validation Percentage:</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="validation_percentage" placeholder="Enter validation percentage" onchange="updatePercentage()">
                        <div class="input-group-append">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

            </div>            
                
        {% comment %} </form> {% endcomment %}
    </div>   
    
            <!-- Next button -->
            <div class="row mb-3 pt-5 justify-content-center">
                <a id="continueButton" type="submit" class="btn btn-lg article">Start Trainings <i class=" pl-2 fa fa-upload"></i></a>
            </div>
</div>
</div>  
    <div class="text-center" style="display: none;" id="select-model-btn">
        <a type="button" class="btn article">Select Model</a>
    </div>  
   

    {% endif %}
<style>
    .cv-task-button.active {
        background-color: green !important; /* Change the active color as needed */
        color: white;
    }
        .divider-vertical {
            height: 100%;
            width: 1px;
            background-color: #ccc; /* Change the color as needed */
            margin: 0 auto;
        }
        
    .divider-vertical {
        height: 100%;
        width: 1px;
        background-color: #ccc; /* Change the color as needed */
        margin: 0 auto;
    }
    .cv-task-button.active {
        background-color: green !important; /* Change the active color as needed */
        color: white;
    }
    hr.solid {
        border-top: 2px solid #999;
    }
    .selectable-button {
        padding: 10px 20px;
        margin-right: 10px;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 20px;
        cursor: pointer;
        position: relative;
        float: left;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      
      .selectable-button.selected {
        background-color: green;
        color: white;
      }
      
      .selectable-button.selected::before {
        content: '\2713';
        margin-right: 5px;
        position: absolute;
        left: 5px;
      }
      
      .selectable-button.selected::after {
        content: '';
        display: block;
        clear: both;
      }
      
      .selectable-button:hover {
        background-color: #f0f0f0;
        transform: scale(1.05);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
      }
      
      .selectable-button.selected:hover {
        background-color: #5cb85c;
        transform: scale(1.05);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
      }      
      
    .title-container {
        text-align: center; /* Center the title */
        margin-bottom: 20px; /* Add some space below the title */
        background-color: #02310D; /* Green background color */
        
    }
    .modal-title {
        color: white; /* Title color */
        margin: 0; /* Remove default margin */
    }
    /* Style Cancel button */
    .cancel-btn {
        margin-right: 5px; /* Add margin between buttons */
    }
    
    /* Ensure close button is aligned properly */
    .close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        color: #aaa;
    }
        /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }
      
      /* Modal Content/Box */
      .modal-content {
        background-color: transparent;
        margin: 15% auto;
        width: 50%; /* Could be more or less, depending on screen size */
      }
      
      /* Close Button */
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      
      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
      
        .modal-backdrop {
            filter: blur(2px);
        }
    button.article {
        background: #025A42 !important;
        color: #fff !important;
        border-top-left-radius: 20px; /* Round the top-left corner */
        border-bottom-left-radius: 20px; /* Round the bottom-left corner */
        border-top-right-radius: 20px; /* Round the top-right corner */
        border-bottom-right-radius: 20px; /* Round the bottom-right corner */
        padding: 5px 10px; /* Adjust padding as needed */
    }
    .dataset {
        background: #025A42 !important;
        color: #fff !important;
        border-top-left-radius: 20px; /* Round the top-left corner */
        border-bottom-left-radius: 20px; /* Round the bottom-left corner */
        border-top-right-radius: 20px; /* Round the top-right corner */
        border-bottom-right-radius: 20px; /* Round the bottom-right corner */
        padding: 5px 10px; /* Adjust padding as needed */
    }
    .form-label {
        font-size: 16px;
        font-weight: bold;
    }
    .card-model {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add shadow */
        border: 2px solid transparent; /* Default border size and color */
    }
    .card-title {
        font-size: 20px;
        font-weight: bold;
    }
    .card-model p {
        font-size: 14px;
        font-weight: 600;
        color: #4E4D4D;
    }
    .card-model:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2); /* Increase shadow on hover */
    }
   
    .card-selected {
        background-color: #f0f0f0; /* Greyish background color for selected card */
        border: 3px solid black; /* Increase border size and change color to black when selected */
    }
    /* Style for selected radio button */
    .card-radio-input:checked + .card-img-top {
        filter: invert(100%);
    }
    /* Directly set color of selected radio button */
    .card-radio-input:checked {
        color: black;
    }
</style>
<script>
    
    function updatePercentage() {
        var trainPercentage = parseInt(document.getElementById('train_percentage').value);
        var testPercentage = parseInt(document.getElementById('test_percentage').value);
        var validationPercentage = parseInt(document.getElementById('validation_percentage').value);
        
        // Ensure individual percentages are within bounds
        if (trainPercentage > 100) {
            document.getElementById('train_percentage').value = 100;
            trainPercentage = 100;
        }
        if (testPercentage > 100) {
            document.getElementById('test_percentage').value = 100;
            testPercentage = 100;
        }
        if (validationPercentage > 100) {
            document.getElementById('validation_percentage').value = 100;
            validationPercentage = 100;
        }
        
        // Ensure total percentage does not exceed 100%
        var totalPercentage = trainPercentage + testPercentage + validationPercentage;
        if (totalPercentage > 100) {
            var diff = totalPercentage - 100;
            if (trainPercentage >= diff) {
                trainPercentage -= diff;
            } else if (testPercentage >= diff) {
                testPercentage -= diff;
            } else if (validationPercentage >= diff) {
                validationPercentage -= diff;
            }
            document.getElementById('train_percentage').value = trainPercentage;
            document.getElementById('test_percentage').value = testPercentage;
            document.getElementById('validation_percentage').value = validationPercentage;
        }
    }
    // JavaScript for closing the modal when the close button or cancel button is clicked
document.addEventListener("DOMContentLoaded", function() {
    const modal = document.getElementById("datasetModal");
    const closeButton = modal.querySelector(".close-button");
    const cancelButton = modal.querySelector(".cancel-button");

    closeButton.addEventListener("click", function() {
        modal.style.display = "none"; // Hide the modal
    });

    cancelButton.addEventListener("click", function() {
        modal.style.display = "none"; // Hide the modal
    });
});
    // JavaScript for closing the modal when the close button is clicked
document.addEventListener("DOMContentLoaded", function() {
    const modal = document.getElementById("datasetModal");
    const closeButton = modal.querySelector(".close-button");

    closeButton.addEventListener("click", function() {
        modal.style.display = "none"; // Hide the modal
    });
});
    // JavaScript for toggling section visibility based on button clicks
document.addEventListener("DOMContentLoaded", function() {
    const buttons = document.querySelectorAll(".nlp-task-button");
    const sections = document.querySelectorAll(".nlp-task-section");

    buttons.forEach(button => {
        button.addEventListener("click", function() {
            const sectionId = this.getAttribute("data-section-id");
            sections.forEach(section => {
                if (section.id === sectionId) {
                    section.style.display = "block";
                } else {
                    section.style.display = "none";
                }
            });
        });
    });
});
    document.addEventListener('DOMContentLoaded', function() {
        const cvButtons = document.querySelectorAll('.cv-task-button');
        const cvSections = document.querySelectorAll('.cv-task-section');

        cvButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                cvButtons.forEach(btn => btn.classList.remove('active'));

                // Add active class to the clicked button
                button.classList.add('active');

                // Hide all sections
                cvSections.forEach(section => section.style.display = 'none');

                // Show the corresponding section based on the clicked button
                const sectionId = button.getAttribute('data-section-id');
                const section = document.getElementById(sectionId);
                section.style.display = 'block';
            });
        });
    });
    document.addEventListener('DOMContentLoaded', function() {
        const cvButton = document.getElementById('cv-button');
        const cvTasks = document.getElementById('cv-tasks');
        const nlpButton = document.getElementById('nlp-button');
        const nlpTasks = document.getElementById('nlp-tasks');
        const timeSeriesButton = document.getElementById('time-series-button');
        const timeSeriesTasks = document.getElementById('time-series-tasks');
    
        // Add event listener to the "Computer Vision" button
        cvButton.addEventListener('click', function() {
            // Display CV task buttons
            cvTasks.style.display = 'block';
    
            // Hide other task buttons if they were displayed
            nlpTasks.style.display = 'none';
            timeSeriesTasks.style.display = 'none';
        });
    
        // Add event listener to the "NLP" button
        nlpButton.addEventListener('click', function() {
            // Display NLP task buttons
            nlpTasks.style.display = 'block';
    
            // Hide CV and Time Series task buttons
            cvTasks.style.display = 'none';
            timeSeriesTasks.style.display = 'none';
        });
    
        // Add event listener to the "Time Series" button
        timeSeriesButton.addEventListener('click', function() {
            // Display Time Series task buttons
            timeSeriesTasks.style.display = 'block';
    
            // Hide CV and NLP task buttons
            cvTasks.style.display = 'none';
            nlpTasks.style.display = 'none';
        });
    });    
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.selectable-button');
      
        buttons.forEach(button => {
          button.addEventListener('click', function() {
            buttons.forEach(btn => {
              btn.classList.remove('selected');
            });
            button.classList.add('selected');
          });
        });
      });
      
    document.addEventListener('DOMContentLoaded', function () {
        // Function to close the dataset modal
        function closeModal() {
            document.getElementById('datasetModal').style.display = 'none';
        }
    
        // Add event listener to show dataset modal
        var modalTriggerBtn = document.getElementById('datasetModalTrigger');
        modalTriggerBtn.addEventListener('click', function () {
            document.getElementById('datasetModal').style.display = 'block';
        });
    
        // Add event listener to handle form submission
        var datasetForm = document.getElementById('datasetForm');
        var submitButton = document.getElementById('submitDatasetBtn');
        submitButton.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default form submission
    
            // Get the selected dataset directly from the form
            var selectedDatasetInput = document.querySelector('input[name="selectedDataset"]:checked');
    
            if (selectedDatasetInput) {
                var selectedDataset = selectedDatasetInput.value;
                var selectedDatasetId = selectedDatasetInput.getAttribute('data-id');
            
                // Update the DOM to display the selected dataset and its ID
                document.getElementById('selectedDataset').textContent = selectedDataset;
                document.getElementById('selectedDatasetContainer').style.display = 'block';
                document.getElementById('selectedDataset').setAttribute('data-id', selectedDatasetId); // Set dataset ID
            
                // Log the dataset ID
                console.log('Dataset Id: ', selectedDatasetId);
    
                // Determine the dataset type
                var datasetType = determineDatasetType(selectedDataset);

                // Determine the dataset size
                var datasetSize = determineDatasetSize(selectedDataset, datasetType);

                // Display options based on dataset type and size
                displayOptions(datasetType, datasetSize);

                // Close the modal after submission
                closeModal();
            } else {
                // If no dataset is selected, display an error message or handle it accordingly
                console.log('Please select a dataset.');
            }
        });
    
        // Add event listener to close dataset modal (using the modal close button)
        var modalCloseBtn = document.getElementById('modalCloseBtn');
        modalCloseBtn.addEventListener('click', function () {
            closeModal();
        });
    
        // Add event listener to close dataset modal (using the modal background)
        var modalBackground = document.getElementById('datasetModal');
        modalBackground.addEventListener('click', function (event) {
            if (event.target === modalBackground) {
                closeModal();
            }
        });

        // Add event listener to remove the selected dataset
        var removeDatasetBtn = document.getElementById('removeDatasetBtn');
        removeDatasetBtn.addEventListener('click', function () {
            document.getElementById('selectedDatasetContainer').style.display = 'none';
            document.getElementById('selectedDataset').textContent = '';
        });
    });        

    function determineDatasetType(datasetContent) {
        // Split the dataset content by line breaks to analyze each line
        var lines = datasetContent.split('\n');

        // Check if the dataset content includes image data
        var imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp'];
        var containsImage = lines.some(function(line) {
            return imageExtensions.some(function(extension) {
                return line.trim().toLowerCase().endsWith(extension);
            });
        });

        if (containsImage) {
            return 'image';
        }

        // Check if the dataset content includes CSV data
        var containsCSVHeader = lines[0].split(',').length > 1;
        if (containsCSVHeader) {
            return 'csv';
        }

        // If no specific type is detected, return 'unknown'
        return 'unknown';
    }

    function determineDatasetSize(datasetContent, datasetType) {
        if (datasetType === 'image') {
            // Count the number of image files
            var lines = datasetContent.split('\n');
            var imageCount = lines.filter(function(line) {
                return line.trim() !== ''; // Exclude empty lines
            }).length;

            return imageCount;
        } else if (datasetType === 'csv') {
            // Count the number of rows in CSV data
            var rows = datasetContent.split('\n');
            // Exclude the header row if present
            var rowCount = rows.length - 1; // Subtract 1 for the header row
            return rowCount;
        }

        // For other types or unknown type, return 0
        return 0;
    }

    function displayOptions(datasetType, datasetSize) {
        // Display options for selecting the percentage of data
        // to be used for training, validation, and testing based on dataset type and size
        if (datasetType === 'image') {
            console.log('Image dataset detected with ' + datasetSize + ' images.');
            // Display options for image dataset
        } else if (datasetType === 'csv') {
            console.log('CSV dataset detected with ' + datasetSize + ' rows.');
            // Display options for CSV dataset
        } else {
            console.log('Unknown dataset type.');
            // Display options for unknown dataset type
        }
    }

    // Get all radio buttons
    var radioButtons = document.querySelectorAll('.card-radio-input');

    // Add event listener to each radio button
    radioButtons.forEach(function(radioButton) {
        radioButton.addEventListener('change', function() {
            // Remove the 'card-selected' class from all cards
            document.querySelectorAll('.card').forEach(function(card) {
                card.classList.remove('card-selected');
            });
    
            // Add the 'card-selected' class to the parent card of the selected radio button
            this.closest('.card').classList.add('card-selected');
    
            // Check which card is selected
            var selectedCardId = this.id;
            if (selectedCardId === 'model1') {
                // Show the form
                document.querySelector('.center-container').style.display = 'flex';
                // Hide the select model button
                document.querySelector('#select-model-btn').style.display = 'none';
            } else if (selectedCardId === 'model2') {
                // Hide the form
                document.querySelector('.center-container').style.display = 'none';
                // Show the select model button
                document.querySelector('#select-model-btn').style.display = 'block';
            }
        });
    });    
    
    document.addEventListener('DOMContentLoaded', function () {
        var continueButton = document.querySelector('#continueButton');
        var selectedDomain; // Variable to store the selected domain
        var datasetURLInput = document.getElementById('dataset_url');
        var trainPercentageInput = document.getElementById('train_percentage');
        var testPercentageInput = document.getElementById('test_percentage');
        var validationPercentageInput = document.getElementById('validation_percentage');
        var selectedTaskSection; // Variable to store the selected task section
    
        // Add event listener to each domain button
        document.querySelectorAll('.selectable-button').forEach(function(button) {
            button.addEventListener('click', function() {
                selectedDomain = this.textContent; // Set the selected domain to the button text
                console.log('Selected Domain:', selectedDomain);
                // If the selected domain is NLP or CV, show respective tasks
                if (selectedDomain === 'Computer Vision') {
                    showTaskSection('cv-tasks');
                } else if (selectedDomain === 'NLP') {
                    showTaskSection('nlp-tasks');
                }
            });
        });

        function showTaskSection(taskSectionId) {
            if (selectedTaskSection) {
                selectedTaskSection.style.display = 'none';
                clearFormData(selectedTaskSection);
            }
            selectedTaskSection = document.getElementById(taskSectionId);
            selectedTaskSection.style.display = 'block';
        }
        
        function clearFormData(taskSection) {
            var inputs = taskSection.querySelectorAll('input, select, textarea');
            inputs.forEach(function(input) {
                if (input.type !== 'checkbox') {
                    input.value = '';
                } else {
                    input.checked = false;
                }
            });
        }
    
        continueButton.addEventListener('click', function (event) {
            // Prevent form submission
            event.preventDefault();
            // Capture model type (New Model or FineTune)
            // var modelType = document.querySelector('input[name="model"]:checked').value;
    
            // Capture selected domain from the active domain button
            var selectedDomain = document.querySelector('.selectable-button.selected')?.textContent.trim();
    
            // Perform form validation
    
            // Check if a domain is selected
            if (!selectedDomain) {
                console.error('Please select a domain!');
                return;
            }
    
            // Check if dataset URL is provided
            var datasetURL = datasetURLInput.value.trim();
            if (!datasetURL) {
                console.error('Please provide a dataset URL!');
                return;
            }

            // Validate percentages
        var trainPercentage = parseInt(document.getElementById('train_percentage').value);
        var testPercentage = parseInt(document.getElementById('test_percentage').value);
        var validationPercentage = parseInt(document.getElementById('validation_percentage').value);
        if (trainPercentage + testPercentage + validationPercentage !== 100) {
            console.error('Percentage values must add up to 100!');
            return;
        }
    
            // Capture task type and details
        var taskType = ''; // Initialize task type
        var taskDetails = {}; // Initialize task details object
        var experimentId = "{{ experiment.id }}";
        if (selectedDomain === 'NLP') {
            document.querySelectorAll('#nlp-tasks .nlp-task-section').forEach(section => {
                if (section.style.display !== 'none') {
                    taskType = section.querySelector('.card-title').textContent; // Capture the task type
                    section.querySelectorAll('input, select').forEach(input => {
                        taskDetails[input.id] = input.value; // Capture task details
                    });
                }
            });
        } else if (selectedDomain === 'Computer Vision') {
            document.querySelectorAll('#cv-tasks .cv-task-section').forEach(section => {
                if (section.style.display !== 'none') {
                    taskType = section.querySelector('.card-title').textContent; // Capture the task type
                    section.querySelectorAll('input, select').forEach(input => {
                        taskDetails[input.id] = input.value; // Capture task details
                    });
                }
            });
        }

        // Compile form data
        var formData = {
            modelName: document.getElementById('model-name').value,
           // modelType: modelType, // Model type (New Model or FineTune)
            modelDomain: selectedDomain, // Selected domain
            datasetURL: datasetURL, // Dataset URL
            trainPercentage: trainPercentage, // Training set percentage
            testPercentage: testPercentage, // Test set percentage
            validationPercentage: validationPercentage, // Validation set percentage
            taskType: taskType, // Task type
            taskConfigs: taskDetails, // Task-specific details
            experimentId: experimentId,
        };

        console.log('Form data:', formData);

        // Placeholder for AJAX call or other form submission method
        sendFormData(formData);
    });


        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Check if the cookie contains the specified name
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        // Extract and return the value of the cookie
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        
    
        function validateForm() {
            var messages = [];
    
            // Perform validation here
            var modelName = document.getElementById('model-name').value.trim();
            var modelDomain = document.getElementById('model-domain').value.trim();
            var selectedDataset = document.querySelector('input[name="selectedDataset"]:checked');
    
            if (!modelName) {
                messages.push("Model Name is required.");
            }
            if (!modelDomain) {
                messages.push("Model Domain is required.");
            }
            if (!selectedDataset) {
                messages.push("Please select a Dataset.");
            }
    
            return {
                isValid: messages.length === 0,
                messages: messages
            };
        }
    
        function displayValidationAlerts(messages) {
            var alertHtml = '<div id="validationAlert" class="alert alert-danger alert-dismissible fade show" role="alert">';
            alertHtml += '<button type="button" class="close" data-dismiss="alert" aria-label="Close">';
            alertHtml += '<span aria-hidden="true">&times;</span></button>';
            alertHtml += '<ul class="list-unstyled">';
            messages.forEach(function (message) {
                alertHtml += '<li>' + message + '</li>';
            });
            alertHtml += '</ul></div>';
    
            // Dynamically create a div for the alert container
            var alertContainer = document.createElement('div');
            alertContainer.innerHTML = alertHtml;
            alertContainer.style.position = 'fixed';
            alertContainer.style.top = '0';
            alertContainer.style.left = '0';
            alertContainer.style.width = '100%';
            alertContainer.style.zIndex = '9999';
            document.body.prepend(alertContainer);
    
            // Auto close the alert after 2 seconds
            var alertElement = document.getElementById('validationAlert');
            setTimeout(function() {
                alertElement.classList.remove('show');
                alertElement.classList.add('hide');
                alertContainer.remove(); 
            }, 2000);
        }
    });

    function sendFormData(formData) {
        console.log('Sending form data:', formData);
        
        fetch('/api/submit_form/', {  // Update this URL based on your `urls.py` configuration
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),  // Ensure you have a function to get the CSRF token
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                displayMessage(data.message, 'success');
                // Redirect to the monitor URL
               window.location.href = data.redirect_url;
            } else {
                displayMessage(data.message, 'error');
            }
        }).catch(error => console.log('Error:', error));
    }

    function displayMessage(message, type) {
        // Example: Append a message to a div with id='messages'
        const messagesDiv = document.getElementById('messages');
        const messageElement = document.createElement('div');
        
        if (type === 'success') {
            messageElement.className = 'alert alert-success'; // Bootstrap class for success
        } else if (type === 'error') {
            messageElement.className = 'alert alert-danger'; // Bootstrap class for error
        }
    
        messageElement.textContent = message;
        messagesDiv.appendChild(messageElement);
    
        // Optionally, add logic to automatically dismiss the message after a certain period
        setTimeout(() => {
            messagesDiv.removeChild(messageElement);
        }, 5000);

    }
    
    // Function to get CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }    

     // function sendFormData(formData) {
            // Here, you'll implement the AJAX call or Fetch API request
            // This is a placeholder function to demonstrate the process
    
      //      console.log('Sending form data:', formData);
    
            // Example with Fetch API
            /*
            fetch('/api/submit_form', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // Include other headers as needed
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => console.log('Success:', data))
            .catch((error) => console.error('Error:', error));
            */
     //   }
    
        // Implement captureSelectedDomain() and captureDomainSpecificDetails() as needed
      /*  function captureSelectedDomain() {
            // Initialize variable to hold the selected domain
            let selectedDomain = '';
        
            // Check if the "Computer Vision" button has the 'selected' class
            if (document.getElementById('cv-button').classList.contains('selected')) {
                selectedDomain = 'Computer Vision';
            }
            // Check if the "NLP" button has the 'selected' class
            else if (document.getElementById('nlp-button').classList.contains('selected')) {
                selectedDomain = 'NLP';
            }
        
            return selectedDomain;
        }
        
    
        function captureDomainSpecificDetails() {
            const domainDetails = {};
        
            // Determine the selected domain
            const selectedDomain = captureSelectedDomain();
        
            if (selectedDomain === 'NLP') {
                // Capture details from the NLP tasks section if NLP is selected
                const nlpSection = document.getElementById('nlp-tasks');
                if (nlpSection.style.display !== 'none') {
                    // Assuming there's only one visible section at a time
                    const visibleSection = nlpSection.querySelector('.nlp-task-section:not([style*="display: none"])');
                    if (visibleSection) {
                        // Example for capturing data from the Machine Translation section
                        if (visibleSection.id === 'machine-translation-section') {
                            domainDetails.task = 'Machine Translation';
                            domainDetails.sourceLanguage = document.getElementById('source_language').value;
                            domainDetails.targetLanguage = document.getElementById('target_language').value;
                            domainDetails.modelArchitecture = document.getElementById('model_architecture').value;
                            // Capture evaluation metrics similarly
                        }
                        else if (visibleSection.id === 'speech-recognition-section') {
                            domainDetails.task = 'Speech Recognition';
                            domainDetails.audioInputFormat = document.getElementById('audio_input_format').value;
                            domainDetails.modelArchitecture = document.getElementById('model_architecture').value; // Assuming unique IDs or adapt as necessary
                            domainDetails.languageModel = document.getElementById('language_model').value;
                            // Capture evaluation metrics similarly
                        }
                        
                        // Placeholder for Named Entity Recognition task
                        else (visibleSection.id === 'named-entity-recognition-section') {
                            domainDetails.task = 'Named Entity Recognition';
                            domainDetails.inputTextFormat = document.getElementById('input_text_format').value;
                            domainDetails.modelArchitecture = document.getElementById('model_architecture').value; // Adjust ID as necessary
                            domainDetails.entityTypes = document.getElementById('entity_types').value;
                            // Capture evaluation metrics similarly
                        }
                    }
                }
            } else if (selectedDomain === 'Computer Vision') {
                // Capture details from the CV tasks section if Computer Vision is selected
                const cvSection = document.getElementById('cv-tasks');
                if (cvSection.style.display !== 'none') {
                    // Assuming there's only one visible section at a time
                    const visibleSection = cvSection.querySelector('.cv-task-section:not([style*="display: none"])');
                    if (visibleSection) {
                        // Example for capturing data from the Object Detection section
                        if (visibleSection.id === 'object-detection-section') {
                            domainDetails.task = 'Object Detection';
                            // Capture specific details like input image size, model architecture, etc.
                            domainDetails.inputImageSize = document.getElementById('input_image_size').value;
                            domainDetails.modelArchitecture = document.getElementById('model_architecture').value;
                            // Capture additional details similarly
                        }
                        else (visibleSection.id === 'image-classification-section') {
                            domainDetails.task = 'Image Classification';
                            domainDetails.numLayers = document.getElementById('num_layers').value;
                            domainDetails.convKernelSize = document.getElementById('conv_kernel_size').value;
                            domainDetails.numFilters = document.getElementById('num_filters').value;
                            domainDetails.learningRate = document.getElementById('learning_rate').value; // Assuming unique IDs or adapt as necessary
                            domainDetails.batchSize = document.getElementById('batch_size').value;
                            domainDetails.optimizer = document.getElementById('optimizer').value;
                            // Capture data augmentation techniques similarly
                        }
                    }
                }
            }
        
            return domainDetails;
        }*/
    
</script>
{% endblock %}
